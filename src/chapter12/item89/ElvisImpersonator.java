package chapter12.item89;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;

public class ElvisImpersonator {
	private static final byte[] serializedForm = { (byte)0xAC, (byte)0xED, (byte)0x00, (byte)0x05, (byte)0x73, (byte)0x72, (byte)0x00, (byte)0x16, (byte)0x63, (byte)0x68, (byte)0x61, (byte)0x70, (byte)0x74, (byte)0x65, (byte)0x72, (byte)0x31, (byte)0x32, (byte)0x2E, (byte)0x69, (byte)0x74, (byte)0x65, (byte)0x6D, (byte)0x38, (byte)0x39, (byte)0x2E, (byte)0x45, (byte)0x6C, (byte)0x76, (byte)0x69, (byte)0x73, (byte)0x34, (byte)0xB8, (byte)0xF2, (byte)0x6E, (byte)0x44, (byte)0xE5, (byte)0xB8, (byte)0x8E, (byte)0x02, (byte)0x00, (byte)0x01, (byte)0x4C, (byte)0x00, (byte)0x0D, (byte)0x66, (byte)0x61, (byte)0x76, (byte)0x6F, (byte)0x72, (byte)0x69, (byte)0x74, (byte)0x65, (byte)0x53, (byte)0x6F, (byte)0x6E, (byte)0x67, (byte)0x73, (byte)0x74, (byte)0x00, (byte)0x12, (byte)0x4C, (byte)0x6A, (byte)0x61, (byte)0x76, (byte)0x61, (byte)0x2F, (byte)0x6C, (byte)0x61, (byte)0x6E, (byte)0x67, (byte)0x2F, (byte)0x4F, (byte)0x62, (byte)0x6A, (byte)0x65, (byte)0x63, (byte)0x74, (byte)0x3B, (byte)0x78, (byte)0x70, (byte)0x73, (byte)0x72, (byte)0x00, (byte)0x1D, (byte)0x63, (byte)0x68, (byte)0x61, (byte)0x70, (byte)0x74, (byte)0x65, (byte)0x72, (byte)0x31, (byte)0x32, (byte)0x2E, (byte)0x69, (byte)0x74, (byte)0x65, (byte)0x6D, (byte)0x38, (byte)0x39, (byte)0x2E, (byte)0x45, (byte)0x6C, (byte)0x76, (byte)0x69, (byte)0x73, (byte)0x53, (byte)0x74, (byte)0x65, (byte)0x61, (byte)0x6C, (byte)0x65, (byte)0x72, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x02, (byte)0x00, (byte)0x01, (byte)0x4C, (byte)0x00, (byte)0x07, (byte)0x70, (byte)0x61, (byte)0x79, (byte)0x6C, (byte)0x6F, (byte)0x61, (byte)0x64, (byte)0x74, (byte)0x00, (byte)0x18, (byte)0x4C, (byte)0x63, (byte)0x68, (byte)0x61, (byte)0x70, (byte)0x74, (byte)0x65, (byte)0x72, (byte)0x31, (byte)0x32, (byte)0x2F, (byte)0x69, (byte)0x74, (byte)0x65, (byte)0x6D, (byte)0x38, (byte)0x39, (byte)0x2F, (byte)0x45, (byte)0x6C, (byte)0x76, (byte)0x69, (byte)0x73, (byte)0x3B, (byte)0x78, (byte)0x70, (byte)0x70 };

	public static void main(String[] args) {
		Elvis elvis = (Elvis) deserialize(serializedForm);
		Elvis impersonator = ElvisStealer.impersonator;

		System.out.println(impersonator);

		elvis.printFavorites();
		impersonator.printFavorites();
	}

	static Object deserialize(byte[] serializedData) {
		try {
			return new ObjectInputStream(new ByteArrayInputStream(serializedData)).readObject();
		} catch (IOException | ClassNotFoundException e) {
			throw new IllegalArgumentException(e);
		}
	}

	static byte[] serialize(Object object) {
		ByteArrayOutputStream bos = new ByteArrayOutputStream();
		try {
			ObjectOutputStream oos = new ObjectOutputStream(bos);
			oos.writeObject(object);
		} catch (Exception e) {
		}
		return bos.toByteArray();
	}

	static void createInvalidElvis() {
		byte[] serializedData = serialize(Elvis.INSTANCE);
		for (byte serializedDatum : serializedData) {
			System.out.print(String.format("(byte)0x%02X, ", serializedDatum));
		}
	}
}
